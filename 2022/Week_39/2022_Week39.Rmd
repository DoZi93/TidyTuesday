---
title: "TidyTuesday Week 39"
author: "Dominik Ziaja"
date: "2022-10-01"
output:
  html_document:
    toc: true
    number_section: true
    toc_float: true
    code_folding: hide
    theme: cerulean
---
# Loading necessities
```{r}
library(tidyverse)
library(showtext)
library(fontawesome)
library(stringr)
library(geojsonio)
library(rgeos)
library(broom)
library(ggthemes)
```


# Setting up fonts that are used
```{r}
font_add_google("Montserrat")
font_headlines <- "Montserrat"
font_add_google("Cousine")
font_text <- "Cousine"
# get the path of font awesome
fa_brands_path <- systemfonts::font_info(family = "Font Awesome 6 Brands")[["path"]]
# add the font under the name of "fa-brands"
font_add(family = "fa-brands", fa_brands_path)

showtext_auto()
```

# Define used colors
```{r}
colors.factors <- c("")
background.color <- ""

```

# Load data
```{r}
data.artists <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-09-27/artists.csv')
US.hexbin <- geojson_read("us_states_hexgrid.geojson", what = "sp")
```

```{r}
library(naniar)

naniar::vis_miss(data.artists)

tibble(data.artists)

data.artists %>%
  summarise_all(~n_distinct(.))
```

# Data wrangling
```{r}

# Since I want to do two plots, first the tidying that's important for both
# plots
data.artists.tidied <- data.artists %>%
  mutate(artists_share = case_when(artists_n == 0 ~ 0,
                                   TRUE ~ artists_share),
         type = tolower(type)) %>%
  mutate(type_summarised = case_when(
          grepl("music", type, fixed=T) ~ "music",
          grepl("architects", type, fixed=T) ~ "architecture",
          type == "entertainers" | type == "announcers" ~ "public",
          type == "producers and directors" | 
            type == "actors" |
            type == "Dancers and Choreographers" ~ "cinema/shows",
          type == "Writers and Authros" | type == "Photographers" ~ "media",
          TRUE ~ type)) %>%
  filter(!is.na(artists_share))

# Data for the stacked barplot showing number of total workers and artists
data.barplot <- data.artists.tidied %>%
  mutate(total_workers_excl_artists = all_workers_n - artists_n) %>%
  group_by(state) %>%
  summarise(across(c("artists_n", "total_workers_excl_artists"), sum)) %>%
  pivot_longer(artists_n:total_workers_excl_artists,
               names_to = "Occupation",
               values_to = "Count") %>%
  mutate(Occupation = 
           case_when(Occupation == "artists_n" ~ "artist",
                    Occupation == "total_workers_excl_artists" ~ "non-artist")) %>%
  arrange(desc(Count))

# Reformat hexbin map to allow merging
US.hexbin@data <- US.hexbin@data %>%
  mutate(google_name = gsub(" \\(United States\\)", "", google_name))

# make hexbin ggplotable
US.hexbin.fortified <- tidy(US.hexbin, region = "google_name")

# calculate centers of each polygon
centers <- cbind.data.frame(data.frame(gCentroid(US.hexbin, byid=T), id=US.hexbin@data$iso3166_2))

# Data for the US hexagon bin plot
data.hexa <- data.artists.tidied %>%
  filter(state != "Puerto Rico") %>%
  group_by(state, race, type_summarised) %>%
  summarise(artists_share_summed = sum(artists_share)) %>%
  group_by(state, race) %>%
  # keeps the group combination with the maximum value
  top_n(1, artists_share_summed) %>%
  group_by(state) %>%
  distinct(race, .keep_all=T) %>%
  mutate(
    type_summarised = case_when(
      artists_share_summed == 0 ~ "No artist shares",
      TRUE ~ type_summarised)) %>%
  left_join(US.hexbin.fortified, by = c("state" = "id"))
  
  
```

# Plot the barplot
```{r}
plot.bar.artistproportion <- ggplot(data = data.barplot,
                                    aes(x = reorder(state, Count),
                                        y = Count, fill = Occupation),
                                    color = "white") +
  geom_bar(stat = "identity") +
  coord_flip()

plot(plot.bar.artistproportion)
```

# Plot the hexagon data
```{r fig.width = 20 fig.height=10}
plot.hexa.artistsshare <- ggplot(data = data.hexa) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = type_summarised),
               color = "white") +
  facet_wrap(~race) +
  geom_text(data = centers, aes(x = x, y = y, label = id)) +
  theme_light() +
  theme(
    panel.grid = element_blank(),
    axis.line = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    strip.background = element_blank(),
    panel_border
  )

plot(plot.hexa.artistsshare)

ggsave("hexamap.png", width = 18, height = 7.5)
```


## List of professions and how to summarise these:
* ~~architects~~ $\rightarrow$ architecture
* ~~Landscape architects~~ $\rightarrow$ architecture
* Fine Artists, Art directors and animators
* Designers
* ~~Actors~~ $\rightarrow$ cinema/shows
* ~~Producers and Directors~~ $\rightarrow$ cinema/shows
* ~~Dancers and Choreographers~~ $\rightarrow$ cinema/shows
* ~~Musicians~~ $\rightarrow$ music
* ~~Music Directors and Composers~~ $\rightarrow$ music
* ~~Entertainers~~ $\rightarrow$ public
* ~~Announcers~~ $\rightarrow$ public
* ~~Writers and Authors~~ $\rightarrow$ media
* ~~Photographers~~ $\rightarrow$ media